#!/bin/bash

# Web4 ONCE Deinstall - Direct execution bypassing environment setup
# Clean execution without nonsensical build environment setup

set -euo pipefail

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
COMPONENT_DIR="$SCRIPT_DIR"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo "üßπ Web4 ONCE Deinstall - Comprehensive Ecosystem Reset"
echo "üìÇ Component: $COMPONENT_DIR"

# Build Web4CompliantONCE if needed (minimal output)
build_once_if_needed() {
    if [ ! -f "$COMPONENT_DIR/dist/Web4CompliantONCE.js" ]; then
        echo "üîß Building ONCE for deinstall..."
        cd "$COMPONENT_DIR"
        npx tsc src/ts/Web4CompliantONCE.ts --outDir dist --module ES2022 --target ES2022 --moduleResolution node >/dev/null 2>&1
        echo -e "${GREEN}‚úÖ ONCE built${NC}"
    fi
}

# Main execution - direct deinstall without environment setup
main() {
    echo "üöÄ Executing deinstall directly..."
    
    # Build ONCE if needed (minimal setup)
    build_once_if_needed
    
    # Execute deinstall command directly
    if [ -f "$COMPONENT_DIR/dist/Web4CompliantONCE.js" ]; then
        node "$COMPONENT_DIR/dist/Web4CompliantONCE.js" deinstall
    else
        echo -e "${RED}‚ùå ONCE deinstall not available${NC}"
        exit 1
    fi
}

# Execute with all arguments
main "$@"
@startuml ScenarioComponentExtraction
!theme toy
title Proposed Architecture: Scenario Component Extraction via Unit

package "Current Duplicated Architecture" <<Rectangle>> {
  class Web4Requirement {
    âŒ saveScenario()
    âŒ loadFromScenario()
    âŒ generateMDView()
    âŒ updateOverview()
  }
  
  class Web4ChangeRequest {
    âŒ saveScenario()
    âŒ loadFromScenario()
    âŒ generateMDView()
    âŒ updateOverview()
  }
  
  Web4Requirement --> UnitIndexStorage : direct usage
  Web4ChangeRequest --> UnitIndexStorage : direct usage
}

package "Proposed DRY Architecture" <<Rectangle>> {
  
  package "Enhanced Unit Component" <<Cloud>> {
    class UnitScenarioManager {
      ğŸ”¥ CENTRALIZED SCENARIO LOGIC
      --
      +saveScenario(type, uuid, data)
      +loadScenario(uuid)
      +deleteScenario(uuid)
      +moveScenario(uuid, newLocation)
      +listScenarios(type?)
      +getScenarioPath(uuid)
      --
      ğŸ“Š Handles all scenario types:
      - Requirements
      - Change Requests  
      - Test Cases
      - Any Web4 scenario
    }
    
    class UnitViewGenerator {
      ğŸ”¥ CENTRALIZED VIEW LOGIC
      --
      +generateMDView(scenario, template)
      +processTemplate(template, context)
      +decodeOwnerDetails(scenario)
      +saveView(uuid, content, directory)
      --
      ğŸ“Š Template-agnostic processing
      ğŸ¨ Supports multiple view types
      ğŸ“ Consistent owner handling
    }
    
    class UnitOverviewBuilder {
      ğŸ”¥ CENTRALIZED OVERVIEW LOGIC
      --
      +buildOverview(type, directory)
      +aggregateScenarios(filter)
      +generateSummaryStats()
      +updateOverviewFile()
      --
      ğŸ“Š Multi-component support
      ğŸ“‹ Consistent overview format
      âš¡ Efficient batch processing
    }
  }
  
  package "Simplified Client Components" <<Cloud>> {
    class Web4Requirement_v2 {
      âœ… BUSINESS LOGIC ONLY
      --
      +create(title, description)
      +update(attribute, value)
      +validate()
      +getStatus()
      --
      ğŸ¯ No storage concerns
      ğŸ¯ No view concerns
      ğŸ¯ Pure business logic
    }
    
    class Web4ChangeRequest_v2 {
      âœ… BUSINESS LOGIC ONLY
      --
      +create(title, description) 
      +update(attribute, value)
      +validate()
      +getStatus()
      +getRelatedRequirements()
      --
      ğŸ¯ No storage concerns
      ğŸ¯ No view concerns  
      ğŸ¯ Pure business logic
    }
    
    class Web4TestCase {
      âœ… BUSINESS LOGIC ONLY
      --
      +create(title, description)
      +update(attribute, value)
      +validate()
      +getStatus()
      +getTestResults()
      --
      ğŸ¯ New component possible
      ğŸ¯ Consistent architecture
    }
  }
}

' New clean dependencies
Web4Requirement_v2 --> UnitScenarioManager : delegates storage
Web4Requirement_v2 --> UnitViewGenerator : delegates views
Web4Requirement_v2 --> UnitOverviewBuilder : delegates overviews

Web4ChangeRequest_v2 --> UnitScenarioManager : delegates storage
Web4ChangeRequest_v2 --> UnitViewGenerator : delegates views
Web4ChangeRequest_v2 --> UnitOverviewBuilder : delegates overviews

Web4TestCase --> UnitScenarioManager : delegates storage
Web4TestCase --> UnitViewGenerator : delegates views
Web4TestCase --> UnitOverviewBuilder : delegates overviews

' Internal Unit dependencies
UnitScenarioManager --> UnitIndexStorage : enhanced usage
UnitViewGenerator --> DefaultUser : owner handling
UnitOverviewBuilder --> UnitScenarioManager : scenario access

package "Architecture Benefits" <<Rectangle>> {
  note as Benefits
    âœ… **DRY Compliance:**
    - Single source of truth for scenario logic
    - Shared view generation system
    - Consistent CLI patterns via Unit
    
    âœ… **Separation of Concerns:**
    - Business logic in domain components
    - Storage logic in Unit component
    - View logic in Unit component
    
    âœ… **Extensibility:**
    - Easy to add new scenario types
    - Consistent behavior across components
    - Centralized enhancement point
    
    âœ… **Maintainability:**
    - Single place to fix bugs
    - Single place to add features
    - Reduced testing surface area
    
    âœ… **Web4 Compliance:**
    - Unit as central orchestrator
    - Scenario-based initialization
    - IOR-based references maintained
  end note
}

@enduml

#!/bin/bash

# Web4 Build Component v0.3.0.3 - Dependency-free build system
# Self-bootstrapping shell script

COMPONENT_VERSION="0.3.0.3"
COMPONENT_DIR="/workspace/components/Build/$COMPONENT_VERSION"

echo "ğŸ—ï¸ Web4 Build Component v$COMPONENT_VERSION"
echo "ğŸ“‚ Component: $COMPONENT_DIR"

# Check environment
echo "ğŸ” Checking environment..."
if ! command -v node &> /dev/null; then
    echo "âŒ Node.js not found. Please install Node.js"
    exit 1
fi

if ! command -v npm &> /dev/null; then
    echo "âŒ npm not found. Please install npm"
    exit 1
fi

# Build self if needed
if [ ! -d "$COMPONENT_DIR/dist" ]; then
    echo "ğŸ—ï¸ Building Build component (self-bootstrap)..."
    cd "$COMPONENT_DIR"
    npm install --silent
    npx tsc
    echo "âœ… Build component ready"
fi

# Delegate to CLI
echo "ğŸš€ Delegating to Build CLI..."
cd "$COMPONENT_DIR"
node dist/ts/layer5/BuildCLI.js "$@"
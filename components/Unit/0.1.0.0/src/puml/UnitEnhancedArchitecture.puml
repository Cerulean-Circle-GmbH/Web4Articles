@startuml UnitEnhancedArchitecture
!theme toy
title Unit Component - Enhanced Architecture (Proposed)

package "Enhanced Unit Component" <<Rectangle>> {
  
  package "Layer 4 - Scenario Services" <<Cloud>> {
    class UnitScenarioManager {
      ğŸ”¥ CENTRAL SCENARIO ORCHESTRATION
      --
      -storage: UnitIndexStorage
      -user: DefaultUser
      --
      +saveScenario(type, uuid, data, context)
      +loadScenario(uuid)
      +deleteScenario(uuid, cleanup?)
      +moveScenario(uuid, newLocations)
      +listScenarios(type?, filter?)
      +validateScenario(scenario)
      +getScenarioMetadata(uuid)
      +bulkOperations(scenarios[], operation)
      --
      ğŸ“Š Type-aware scenario handling
      ğŸ¯ Business logic validation
      ğŸ”„ Batch operations support
      âœ… Consistent error handling
    }
    
    class UnitViewGenerator {
      ğŸ”¥ CENTRAL VIEW GENERATION
      --
      -templateProcessor: TemplateProcessor
      -scenarioManager: UnitScenarioManager
      --
      +generateMDView(uuid, templatePath, outputDir?)
      +processTemplate(template, scenario)
      +decodeOwnerDetails(scenario)
      +saveView(uuid, content, directory)
      +generateBulkViews(uuids[], template)
      +getViewTemplate(type)
      +validateTemplate(template)
      --
      ğŸ“ Template-agnostic processing
      ğŸ‘¤ Integrated owner handling
      ğŸ¨ Multiple view format support
      âš¡ Efficient bulk generation
    }
    
    class UnitOverviewBuilder {
      ğŸ”¥ CENTRAL OVERVIEW GENERATION
      --
      -scenarioManager: UnitScenarioManager
      -viewGenerator: UnitViewGenerator
      --
      +buildOverview(type, directory, options?)
      +aggregateScenarios(filter, groupBy?)
      +generateSummaryStats(scenarios[])
      +updateOverviewFile(directory, content)
      +getOverviewTemplate(type)
      +customizeOverview(template, data)
      +scheduleOverviewUpdate(directory)
      --
      ğŸ“Š Multi-component aggregation
      ğŸ“‹ Flexible grouping options
      ğŸ“ˆ Statistical analysis
      ğŸ”„ Auto-update capabilities
    }
    
    class UnitCLIService {
      ğŸ”¥ CENTRAL CLI PATTERN SERVICE
      --
      -scenarioManager: UnitScenarioManager
      -viewGenerator: UnitViewGenerator
      -overviewBuilder: UnitOverviewBuilder
      --
      +handleCreate(type, args)
      +handleDelete(identifier)
      +handleUpdate(uuid, attribute, value)
      +handleMove(uuid, destination)
      +handleOverview(directory)
      +handleBulk(operation, filter)
      +getUsageHelp(command?)
      --
      ğŸ¯ Consistent CLI patterns
      ğŸ“‹ Type-specific behavior
      ğŸ”§ Extensible command set
      ğŸ’¬ Standardized help system
    }
  }
  
  package "Layer 3 - Service Interfaces" <<Cloud>> {
    interface ScenarioService {
      +save(type, uuid, data)
      +load(uuid)
      +delete(uuid)
      +list(filter?)
    }
    
    interface ViewService {
      +generate(uuid, template)
      +process(template, data)
      +save(uuid, content, directory)
    }
    
    interface OverviewService {
      +build(type, directory)
      +aggregate(filter)
      +update(directory)
    }
    
    interface CLIService {
      +handle(command, args)
      +getHelp(command?)
    }
  }
  
  package "Layer 2 - Storage (Enhanced)" <<Cloud>> {
    class UnitIndexStorage {
      ğŸ“Š ENHANCED STORAGE FOUNDATION
      --
      +init(projectRoot)
      +saveScenario(uuid, scenario, symlinks?)
      +loadScenario(uuid)
      +deleteScenario(uuid) â­ ENHANCED
      +bulkLoad(uuids[]) â­ NEW
      +query(filter) â­ NEW
      +getStatistics() â­ NEW
      --
      ğŸ—‚ï¸ UUID-based 5-level storage
      ğŸ”— Enhanced symlink management
      ğŸ“‹ Advanced backlink tracking
      âš¡ Query capabilities
    }
  }
}

package "Simplified Client Components" <<Cloud>> {
  class Web4Requirement_v2 {
    âœ… PURE BUSINESS LOGIC
    --
    -unitServices: UnitCLIService
    --
    +create(title, description)
    +validate()
    +getBusinessRules()
    --
    ğŸ¯ Domain-specific logic only
    ğŸ”„ Delegates all infrastructure
  }
  
  class Web4ChangeRequest_v2 {
    âœ… PURE BUSINESS LOGIC
    --
    -unitServices: UnitCLIService
    --
    +create(title, description)
    +validate()
    +getRelatedRequirements()
    --
    ğŸ¯ Domain-specific logic only
    ğŸ”„ Delegates all infrastructure
  }
  
  class Web4TestCase {
    âœ… NEW COMPONENT POSSIBLE
    --
    -unitServices: UnitCLIService
    --
    +create(title, description)
    +execute()
    +getResults()
    --
    ğŸ¯ Test-specific logic
    ğŸ”„ Inherits all infrastructure
  }
}

' Service layer dependencies
UnitScenarioManager --> UnitIndexStorage : enhanced usage
UnitViewGenerator --> UnitScenarioManager : scenario access
UnitOverviewBuilder --> UnitScenarioManager : scenario aggregation
UnitOverviewBuilder --> UnitViewGenerator : view generation
UnitCLIService --> UnitScenarioManager : delegates storage
UnitCLIService --> UnitViewGenerator : delegates views
UnitCLIService --> UnitOverviewBuilder : delegates overviews

' Interface implementations
UnitScenarioManager --|> ScenarioService : implements
UnitViewGenerator --|> ViewService : implements
UnitOverviewBuilder --|> OverviewService : implements
UnitCLIService --|> CLIService : implements

' Client component dependencies
Web4Requirement_v2 --> UnitCLIService : uses services
Web4ChangeRequest_v2 --> UnitCLIService : uses services
Web4TestCase --> UnitCLIService : uses services

package "Architecture Benefits" <<Rectangle>> {
  note as Benefits
    ğŸ¯ **DRY Achievement:**
    - Single scenario management service
    - Centralized view generation
    - Shared CLI patterns
    - Consistent business logic separation
    
    âœ… **Service Architecture:**
    - Clear separation of concerns
    - Testable service boundaries
    - Extensible service interfaces
    - Consistent error handling
    
    ğŸ”§ **Developer Experience:**
    - Simple component creation
    - Consistent CLI behavior
    - Reusable service patterns
    - Clear architecture guidelines
    
    ğŸ“Š **Operational Benefits:**
    - Centralized monitoring
    - Consistent logging
    - Single point for optimizations
    - Unified maintenance
    
    ğŸš€ **Scalability:**
    - Easy to add new scenario types
    - Service-based extension points
    - Modular component architecture
    - Web4-compliant patterns
  end note
}

@enduml

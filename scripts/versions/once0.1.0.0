#!/bin/bash
# ONCE Interactive Demo v0.1.0.0 - Location Resilient Launcher
# Generated by setup-once-links.sh

find_project_root() {
    local current_dir="$PWD"
    local git_root=$(git rev-parse --show-toplevel 2>/dev/null)
    if [ -n "$git_root" ]; then
        echo "$git_root"
        return 0
    fi
    
    local dir="$current_dir"
    while [ "$dir" != "/" ]; do
        if [ -f "$dir/package.json" ]; then
            echo "$dir"
            return 0
        fi
        dir=$(dirname "$dir")
    done
    
    echo "$current_dir"
}

PROJECT_ROOT=$(find_project_root)
ONCE_VERSION="0.1.0.0"
DEMO_PATH="$PROJECT_ROOT/components/ONCE/$ONCE_VERSION/examples/multi-env-demo"
DEMO_SCRIPT="$DEMO_PATH/interactive-demo.js"

if [ ! -f "$DEMO_SCRIPT" ]; then
    echo "‚ùå ONCE Demo not found at: $DEMO_SCRIPT"
    echo "üìÅ Expected path: components/ONCE/$ONCE_VERSION/examples/multi-env-demo/"
    exit 1
fi

CURRENT_DIR="$PWD"
cd "$DEMO_PATH"

# Handle command line arguments
if [ $# -eq 0 ]; then
    echo "üé≠ Starting ONCE Interactive Demo v$ONCE_VERSION..."
    echo "üìÅ Demo path: $DEMO_PATH"
    echo "üåê Browser auto-opening enabled"
    node interactive-demo.js
elif [ "$1" = "--headless" ]; then
    echo "üé≠ Starting ONCE Demo v$ONCE_VERSION (headless mode)..."
    echo "üìÅ Demo path: $DEMO_PATH"
    echo "üñ•Ô∏è  Server-only mode (no browser auto-opening)"
    node interactive-demo.js --headless
elif [ "$1" = "--help" ] || [ "$1" = "help" ]; then
    echo ""
    echo "üé≠ ONCE Interactive Demo v$ONCE_VERSION"
    echo "Web4 Universal P2P Communication Engine"
    echo ""
    echo "Usage:"
    echo "  once0.1.0.0                  # Start interactive demo with browser"
    echo "  once0.1.0.0 --headless       # Start demo without browser"
    echo "  once0.1.0.0 --help           # Show this help"
    echo ""
    echo "Demo Controls (interactive mode):"
    echo "  [s] Start/Stop ONCE server"
    echo "  [1] Launch Browser Client"
    echo "  [2] Launch Node.js Client" 
    echo "  [3] Launch Web Worker Client"
    echo "  [d] Discover peers"
    echo "  [e] Exchange scenarios"
    echo "  [q] Quit demo"
    echo ""
    echo "Features:"
    echo "  ‚Ä¢ Cross-platform browser auto-opening"
    echo "  ‚Ä¢ Web4 Message component integration"
    echo "  ‚Ä¢ P2P scenario acknowledgments"
    echo "  ‚Ä¢ Interactive demo controls"
    echo ""
    cd "$CURRENT_DIR"
    exit 0
else
    echo "üé≠ Starting ONCE Interactive Demo v$ONCE_VERSION..."
    echo "üìÅ Demo path: $DEMO_PATH"
    echo "üåê Browser auto-opening enabled"
    node interactive-demo.js "$@"
fi

cd "$CURRENT_DIR"

#!/bin/bash
# ONCE Interactive Demo - Latest Version Launcher
# Generated by setup-once-links.sh

find_project_root() {
    local current_dir="$PWD"
    local git_root=$(git rev-parse --show-toplevel 2>/dev/null)
    if [ -n "$git_root" ]; then
        echo "$git_root"
        return 0
    fi
    
    local dir="$current_dir"
    while [ "$dir" != "/" ]; do
        if [ -f "$dir/package.json" ]; then
            echo "$dir"
            return 0
        fi
        dir=$(dirname "$dir")
    done
    
    echo "$current_dir"
}

PROJECT_ROOT=$(find_project_root)
LATEST_VERSION="0.1.0.0"
VERSIONED_SCRIPT="$PROJECT_ROOT/scripts/versions/once$LATEST_VERSION"

if [ ! -f "$VERSIONED_SCRIPT" ]; then
    echo "‚ùå Latest ONCE script not found: $VERSIONED_SCRIPT"
    echo "üîß Run scripts/setup-once-links.sh to create ONCE links"
    exit 1
fi

# Show usage if no parameters provided
if [ $# -eq 0 ]; then
    echo ""
    echo "üé≠ ONCE Interactive Demo - Web4 Universal P2P Communication Engine"
    echo ""
    echo "Usage:"
    echo "  once demo                    # Start interactive demo with browser auto-opening"
    echo "  once demo --headless         # Start demo without browser (server only)"
    echo "  once demo --help             # Show demo-specific help"
    echo "  once help                    # Show this help message"
    echo "  once version                 # Show ONCE version information"
    echo ""
    echo "Demo Features:"
    echo "  ‚Ä¢ Cross-platform browser auto-opening"
    echo "  ‚Ä¢ Web4 Message component integration"
    echo "  ‚Ä¢ P2P scenario acknowledgments"
    echo "  ‚Ä¢ Interactive demo controls"
    echo "  ‚Ä¢ TTY-aware keyboard input"
    echo ""
    echo "Examples:"
    echo "  once demo                    # Launch full interactive demo"
    echo "  once demo --headless         # Server-only mode for testing"
    echo ""
    echo "Location: Latest version (v$LATEST_VERSION)"
    echo "Path: scripts/versions/once$LATEST_VERSION"
    exit 0
fi

# Handle specific commands
case "$1" in
    "help"|"--help"|"-h")
        echo ""
        echo "üé≠ ONCE Interactive Demo - Web4 Universal P2P Communication Engine"
        echo ""
        echo "Usage:"
        echo "  once demo                    # Start interactive demo"
        echo "  once demo --headless         # Start demo without browser"
        echo "  once demo --help             # Show demo help"
        echo "  once help                    # Show this help"
        echo "  once version                 # Show version info"
        echo ""
        exit 0
        ;;
    "version"|"--version"|"-v")
        echo "ONCE Interactive Demo v$LATEST_VERSION"
        echo "Web4 Universal P2P Communication Engine"
        echo "Path: $VERSIONED_SCRIPT"
        exit 0
        ;;
    "demo")
        echo "üöÄ Launching ONCE Demo (latest: v$LATEST_VERSION)..."
        shift  # Remove 'demo' from arguments
        exec "$VERSIONED_SCRIPT" "$@"
        ;;
    *)
        echo "‚ùå Unknown command: $1"
        echo "Run 'once help' for usage information"
        exit 1
        ;;
esac

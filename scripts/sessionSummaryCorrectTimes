#!/bin/bash
# sessionSummaryCorrectTimes - Extract original dev/req0305 commit times
# Purpose: Map PDCA files to their original commit times from dev/req0305

SESSION_PATH="$1"
OUTPUT_FILE="$2"

if [ -z "$SESSION_PATH" ]; then
    echo "Usage: sessionSummaryCorrectTimes <sessionPath> [outputFile]"
    exit 1
fi

echo "ðŸš€ sessionSummaryCorrectTimes Tool Starting..."

# Create mapping of original dev/req0305 commits to UTC times
declare -A COMMIT_TO_UTC
COMMIT_TO_UTC["2e065580"]="2025-09-12-UTC-1508"
COMMIT_TO_UTC["9eaca7c7"]="2025-09-12-UTC-1816" 
COMMIT_TO_UTC["dec7d167"]="2025-09-12-UTC-1828"
COMMIT_TO_UTC["039112d4"]="2025-09-12-UTC-1854"
COMMIT_TO_UTC["109de77a"]="2025-09-12-UTC-2005"
COMMIT_TO_UTC["61b82753"]="2025-09-12-UTC-2029"
COMMIT_TO_UTC["469cba80"]="2025-09-12-UTC-2045"
COMMIT_TO_UTC["f6857c9f"]="2025-09-13-UTC-0828"
COMMIT_TO_UTC["748fb825"]="2025-09-13-UTC-1129"
COMMIT_TO_UTC["3c8ad277"]="2025-09-13-UTC-1141"
COMMIT_TO_UTC["79f3613b"]="2025-09-13-UTC-1200"
COMMIT_TO_UTC["64ab89b3"]="2025-09-13-UTC-1215"
COMMIT_TO_UTC["ab34b83d"]="2025-09-13-UTC-1236"
COMMIT_TO_UTC["54425437"]="2025-09-13-UTC-1245"
COMMIT_TO_UTC["c036679e"]="2025-09-13-UTC-1307"
COMMIT_TO_UTC["713ea5c2"]="2025-09-13-UTC-1322"

# Create PDCA to commit mapping based on content analysis
declare -A PDCA_TO_COMMIT
PDCA_TO_COMMIT["mof-hierarchy-correction"]="2e065580"
PDCA_TO_COMMIT["sophisticated-mof-relationships"]="9eaca7c7"
PDCA_TO_COMMIT["mdav4-folder-structure"]="dec7d167"
PDCA_TO_COMMIT["mdav4-typem3-folder"]="039112d4"
PDCA_TO_COMMIT["systematic-cleanup"]="109de77a"
PDCA_TO_COMMIT["mdav4-version-inconsistency"]="61b82753"
PDCA_TO_COMMIT["unitversion-tracking"]="469cba80"
PDCA_TO_COMMIT["unit-discover-method"]="f6857c9f"
PDCA_TO_COMMIT["automatic-ontology"]="748fb825"
PDCA_TO_COMMIT["comprehensive-copy-discovery"]="3c8ad277"
PDCA_TO_COMMIT["folder-tracking-atomic"]="79f3613b"
PDCA_TO_COMMIT["revolutionary-2002-vision"]="79f3613b"
PDCA_TO_COMMIT["copyinto-method"]="64ab89b3"
PDCA_TO_COMMIT["copyinto-implementation"]="ab34b83d"
PDCA_TO_COMMIT["outdated-tests"]="54425437"
PDCA_TO_COMMIT["unit-system-validation"]="c036679e"
PDCA_TO_COMMIT["unit-system-bugs"]="713ea5c2"
PDCA_TO_COMMIT["dory-mode-violation"]="713ea5c2"
PDCA_TO_COMMIT["zero-config-cli"]="713ea5c2"

echo "ðŸ“Š Generated Table with Correct Original Times:"

TABLE="## **ðŸ“Š Complete Session Analysis Table (Original dev/req0305 Chronological Order with Correct UTC Times)**

**Note:** Table shows original dev/req0305 commit progression with exact TRON quotes and correct commit times.

| **Git SHA** | **UTC Time** | **PDCA Source/Evidence** | **Exact TRON Quotes** | **Key Learning/Achievement** |
|-------------|--------------|--------------------------|------------------------|-----------------------------|"

# Process files in chronological order by original commit time
for sha in "2e065580" "9eaca7c7" "dec7d167" "039112d4" "109de77a" "61b82753" "469cba80" "f6857c9f" "748fb825" "3c8ad277" "79f3613b" "64ab89b3" "ab34b83d" "54425437" "c036679e" "713ea5c2"; do
    UTC_TIME="${COMMIT_TO_UTC[$sha]}"
    
    # Find matching PDCA files for this commit
    case "$sha" in
        "2e065580")
            FILE="$SESSION_PATH/pdca/role/background-agent/2025-09-11-UTC-0007-mof-hierarchy-correction-mdav4-specification.md"
            QUOTES=$(grep -A 20 "### \*\*TRON Feedback" "$FILE" 2>/dev/null | sed -n '/```quote/,/```/p' | grep -v '```' | tr '\n' ' ' || echo "correct the mof hierarchy and add mda units")
            ACHIEVEMENT="MOF Hierarchy Correction - Critical M1/M2/M3 clarification"
            ;;
        "dec7d167")
            FILE="$SESSION_PATH/pdca/role/background-agent/2025-09-11-UTC-0007-mdav4-folder-structure-organization.md"
            QUOTES="when you are into it already create a folder MDAv4 in the  project root. inside a folder M3 and links to all existing units. create units for the folders in M1 folders. do you understand? if not ask. pdca"
            ACHIEVEMENT="MDAv4 Structure Implementation - Complete M3 CLASS/RELATIONSHIP hierarchy"
            ;;
        "79f3613b")
            FILE="$SESSION_PATH/pdca/role/background-agent/2025-09-11-UTC-0007-folder-tracking-atomic-elements-2002-vision.md"
            QUOTES="okâ€¦ now we talk thats where i wanted to be since 2002. now add a method to track folders. for that create a 'Â°folder.unit' 1:1 named like this in every tracked folder. update the 'from' method to handle creating a unit from a folder. update the the other methods if required to handle folder ln link references or git folders"
            ACHIEVEMENT="Revolutionary 2002 Vision Achievement - Â°folder.unit atomic elements"
            ;;
        "713ea5c2")
            FILE="$SESSION_PATH/pdca/role/background-agent/2025-09-11-UTC-0007-unit-system-bugs-eexist-errors-missing-data-analysis.md"
            QUOTES="i additionally found â€žEEXIST" typosâ€¦ wow you do some too. warnings and errors when you could not create what already exists when exitance is mandatory. all missing name reports while name is set.same with definition. sometimes â€šcreate' is used instead of â€šfrom' where a missing origin is ok. pdca about all that needs to be fixed with dual links"
            ACHIEVEMENT="Terminal Failure - EEXIST typos, false missing data (UNRESOLVED)"
            ;;
        *)
            continue
            ;;
    esac
    
    if [ -f "$FILE" ]; then
        FILENAME=$(basename "$FILE")
        REL_PATH=$(realpath --relative-to="$PROJECT_ROOT" "$FILE" 2>/dev/null || echo "$FILE")
        GITHUB_URL="https://github.com/Cerulean-Circle-GmbH/Web4Articles/blob/dev/once0304/$REL_PATH"
        DUAL_LINK="[GitHub]($GITHUB_URL) \\| [$FILENAME]($REL_PATH)"
        
        TABLE="$TABLE
| **$sha** | **$UTC_TIME** | $DUAL_LINK | \`$QUOTES\` | **$ACHIEVEMENT** |"
    fi
done

echo "$TABLE"

if [ -n "$OUTPUT_FILE" ]; then
    echo "$TABLE" > "$OUTPUT_FILE"
    echo ""
    echo "ðŸ’¾ Table with correct original times written to: $OUTPUT_FILE"
fi

echo ""
echo "âœ… sessionSummaryCorrectTimes Complete with Original dev/req0305 Times"